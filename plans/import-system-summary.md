# ملخص نظام استيراد البيانات النموذجية

## المشاكل التي تم حلها

### 1. مشكلة الجدول النموذجي للبيانات
**المشكلة**: الجدول النموذجي كان يكتفي بذكر مجموعة حقول فقط وليس كل الحقول.

**الحل**:
- تم إنشاء ملف [`plans/data-model-table.md`](plans/data-model-table.md) الذي يوثق جميع الحقول الـ36 لنموذج Game
- تم إضافة جدول تحويل يوضح كيفية تحويل النص المنظم إلى بيانات قاعدة البيانات
- تم إضافة مثال كامل للعبة "إِرْمِ إِلْتِرْمي (القرعة)" كنموذج استيراد

### 2. مشكلة استيراد النص
**المشكلة**: عند تجريب استيراد لعبة من النص، كان يستورد فقط حقل القواعد ويترك طريقة اللعب فارغة.

**الحل**:
- تم تحسين دالة `parseArabicText` في [`lib/actions/import.ts`](lib/actions/import.ts) لدعم تنسيقات متعددة (علامات التبويب، النقطتين، المسافات)
- تم إضافة دالة `convertParsedToGameData` لتحويل البيانات المستخرجة إلى تنسيق قاعدة البيانات
- تم إضافة معالجة خاصة للحقول المركبة (مثل `ageGroup` التي تحتوي على `وصف الفئة العمرية`)

## المكونات الجديدة

### 1. نظام التحقق من البيانات
- [`lib/utils/import-validation.ts`](lib/utils/import-validation.ts): يحتوي على مخططات Zod للتحقق من صحة بيانات CSV وJSON
- دوال تحقق للحقول الفردية (الاسم الأساسي، الرابط الثابت، الوصف، القواعد)
- تحقق مجمّع للاستيراد بالجملة مع تقارير أخطاء مفصلة

### 2. لوحة التحكم المحسنة
- [`app/dashboard/page.tsx`](app/dashboard/page.tsx): عرض شامل لجميع حقول البيانات (36 حقل)
- مكونات تفاعلية لعرض البيانات بتنسيق منظم مع إمكانية التوسيع/الطي
- قسم خاص لعرض تنسيقات الاستيراد وقواعد التحقق

### 3. دوال بيانات شاملة
- [`lib/actions/dashboard.ts`](lib/actions/dashboard.ts): دوال لجلب بيانات الألعاب مع جميع العلاقات
- إحصائيات نموذج البيانات وبيانات نموذجية للاستيراد

## تنسيقات الاستيراد المدعومة

### 1. CSV المباشر
```csv
canonicalName,localNames,slug,countryId,region,gameType,ageGroup,practitioners,playersCount,tools,environment,timing,description,rules,winLossSystem,startEndMechanism,oralTradition,socialContext,reviewStatus
```

### 2. النص المنظم (العربي)
```
اسم اللعبة: إِرْمِ إِلْتِرْمي (القرعة)
المسميات المحلية: التسييف
الدولة: الجمهورية العراقية
الإقليم: ساحات المدارس والكتاتيب والحارات الشعبية في عموم العراق
... [جميع الحقول]
```

### 3. JSON
```json
{
  "canonicalName": "إِرْمِ إِلْتِرْمي (القرعة)",
  "localNames": ["التسييف"],
  "countryId": "country_id_here",
  ...
}
```

## عملية التحويل التلقائي

عند استيراد النص المنظم، يتم التحويل التلقائي كما يلي:

1. **استخراج الحقول**: البحث عن أسماء الحقول في النص واستخراج قيمها
2. **تحويل التنسيقات**: 
   - تقسيم القوائم (المسميات المحلية، الأدوات، الوسوم) باستخدام الفواصل
   - تحويل القواعد إلى مصفوفة بناءً على الأسطر الفارغة
3. **البحث في قاعدة البيانات**:
   - البحث عن `countryId` بناءً على اسم الدولة
   - البحث عن `heritageFieldId` بناءً على اسم مجال التراث
   - البحث عن `tagIds` بناءً على أسماء الوسوم
4. **إنشاء البيانات النهائية**: تجميع جميع الحقول في كائن Game جاهز للحفظ

## الاختبار والتحقق

تم اختبار النظام مع مثال اللعبة الكامل وتم التحقق من:
- استخراج جميع الحقول الـ19 من النص المنظم
- تحويلها بشكل صحيح إلى تنسيق قاعدة البيانات
- معالجة الحقول المركبة (مثل ageGroup مع وصف الفئة العمرية)
- دعم تنسيقات متعددة (علامات التبويب، النقطتين، المسافات)

## الخطوات التالية المقترحة

1. **إضافة واجهة استيراد رسومية**: نموذج لرفع ملفات CSV/JSON/نص
2. **معاينة قبل الحفظ**: عرض البيانات المستخرجة للمستخدم للمراجعة قبل الحفظ
3. **معالجة الأخطاء التفاعلية**: إظهار الأخطاء مع إمكانية التصحيح المباشر
4. **استيراد بالجملة**: دعم استيراد multiple games في وقت واحد
5. **تصدير القوالب**: إنشاء قوالب استيراد مخصصة بناءً على البيانات الحالية

تم الانتهاء من النظام في: 2026-01-29