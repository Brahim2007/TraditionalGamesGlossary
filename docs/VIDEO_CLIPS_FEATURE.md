# ميزة مقاطع الفيديو المتعددة

## نظرة عامة

تم تطوير نظام متقدم لإدارة وتشغيل مقاطع فيديو متعددة في خلفية الصفحة الرئيسية. يتيح هذا النظام للمسؤولين اختيار مقاطع محددة من فيديوهات YouTube مختلفة وتشغيلها بشكل متتابع بدون انقطاع.

## المميزات

### 1. إدارة المقاطع من لوحة التحكم
- إضافة عدد غير محدود من مقاطع الفيديو
- تحديد وقت البداية والنهاية لكل مقطع (بالثواني)
- معاينة كل مقطع قبل الحفظ
- إعادة ترتيب المقاطع (قريباً)
- حذف المقاطع غير المرغوبة

### 2. تشغيل ذكي ومتتابع
- تشغيل تلقائي للمقاطع بالترتيب
- انتقال سلس بين المقاطع بدون انقطاع
- تكرار تلقائي عند انتهاء آخر مقطع
- دعم فيديوهات من قنوات مختلفة

### 3. واجهة سهلة الاستخدام
- إدخال الرابط الكامل أو معرف الفيديو فقط
- عرض المدة الإجمالية لجميع المقاطع
- عداد لعدد المقاطع المضافة
- تنسيق الوقت بصيغة دقيقة:ثانية

## كيفية الاستخدام

### الوصول إلى الإعدادات
1. قم بتسجيل الدخول كمسؤول (Admin)
2. انتقل إلى: `Dashboard > الإعدادات > إعدادات الصفحة الرئيسية`

### إضافة مقطع جديد
1. انقر على زر "إضافة مقطع جديد"
2. أدخل البيانات التالية:
   - **عنوان المقطع**: اسم توضيحي للمقطع
   - **رابط الفيديو**: رابط YouTube الكامل أو معرف الفيديو فقط
   - **وقت البداية**: الثانية التي يبدأ منها المقطع
   - **وقت النهاية**: الثانية التي ينتهي عندها المقطع
3. استخدم المعاينة للتأكد من المقطع
4. انقر "حفظ إعدادات الصفحة الرئيسية"

### أمثلة على الروابط المدعومة
```
https://www.youtube.com/watch?v=k-vNeRMMILo
https://youtu.be/k-vNeRMMILo
k-vNeRMMILo
```

### مثال على إعداد مقاطع متعددة

#### المقطع 1: مقدمة
- الفيديو: `k-vNeRMMILo`
- البداية: `0` ثانية (0:00)
- النهاية: `15` ثانية (0:15)

#### المقطع 2: عرض اللعبة
- الفيديو: `k-vNeRMMILo`
- البداية: `30` ثانية (0:30)
- النهاية: `60` ثانية (1:00)

#### المقطع 3: من فيديو آخر
- الفيديو: `dQw4w9WgXcQ`
- البداية: `10` ثانية (0:10)
- النهاية: `25` ثانية (0:25)

**النتيجة**: سيتم تشغيل 3 مقاطع بمدة إجمالية 50 ثانية، ثم يعاد التشغيل من البداية.

## البنية التقنية

### الملفات المعنية

#### 1. قاعدة البيانات
- `prisma/schema.prisma`: نموذج Settings لتخزين المقاطع

#### 2. Server Actions
- `lib/actions/settings.ts`: 
  - `getSetting()`: جلب الإعدادات
  - `upsertSetting()`: حفظ/تحديث الإعدادات
  - `VideoClip` interface: تعريف بنية المقطع

#### 3. مكونات الإدارة
- `app/dashboard/settings/page.tsx`: صفحة الإعدادات الرئيسية
- `app/dashboard/settings/SettingsClient.tsx`: مكون العميل للإعدادات
- `app/dashboard/settings/VideoClipsManager.tsx`: مدير المقاطع التفاعلي

#### 4. مكون التشغيل
- `components/public/HeroVideoPlayer.tsx`: مشغل الفيديو الذكي

#### 5. الصفحة الرئيسية
- `app/(public)/page.tsx`: استخدام HeroVideoPlayer

### بنية البيانات

```typescript
interface VideoClip {
  videoId: string      // معرف فيديو YouTube
  startTime: number    // وقت البداية بالثواني
  endTime: number      // وقت النهاية بالثواني
  title?: string       // عنوان المقطع (اختياري)
}
```

### التخزين في قاعدة البيانات

```json
{
  "key": "hero_video_clips",
  "value": "[{\"videoId\":\"k-vNeRMMILo\",\"startTime\":0,\"endTime\":30,\"title\":\"مقطع 1\"}]",
  "category": "homepage"
}
```

## التقنيات المستخدمة

### YouTube IFrame API
- تحميل ديناميكي للـ API
- التحكم الكامل في التشغيل
- مراقبة حالة المشغل
- الانتقال التلقائي بين المقاطع

### React Hooks
- `useState`: إدارة حالة المقاطع
- `useEffect`: تحميل وتحديث المشغل
- `useRef`: الإشارة إلى مشغل YouTube

### Next.js
- Server Components لجلب البيانات
- Client Components للتفاعل
- Server Actions للحفظ
- Revalidation للتحديث الفوري

## الأداء والتحسينات

### 1. التحميل الذكي
- تحميل YouTube API مرة واحدة فقط
- إعادة استخدام نفس المشغل للمقاطع المختلفة

### 2. الانتقال السلس
- استخدام `loadVideoById` بدلاً من إعادة إنشاء المشغل
- تحديد أوقات البداية والنهاية مسبقاً

### 3. معالجة الأخطاء
- قيم افتراضية عند فشل تحميل الإعدادات
- التحقق من صحة البيانات قبل الحفظ
- رسائل خطأ واضحة للمستخدم

## التطويرات المستقبلية

- [ ] إعادة ترتيب المقاطع بالسحب والإفلات (Drag & Drop)
- [ ] استيراد/تصدير قوائم المقاطع
- [ ] دعم مصادر فيديو أخرى (Vimeo, etc.)
- [ ] تأثيرات انتقالية متقدمة
- [ ] جدولة المقاطع حسب الوقت/التاريخ
- [ ] إحصائيات المشاهدة
- [ ] معاينة مباشرة في صفحة الإعدادات

## الدعم والمساعدة

للإبلاغ عن مشاكل أو اقتراح تحسينات، يرجى التواصل مع فريق التطوير.
